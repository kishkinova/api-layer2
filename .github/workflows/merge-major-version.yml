name: "Merge on major version"

on:
    push:
        branches: [ master ]
    workflow_dispatch:

jobs:
    merge:
        runs-on: ubuntu-latest

        steps:
            - name: Set up Node
              uses: actions/setup-node@v2
              with:
                  node-version: '14'

            - name: Checkout repository
              uses: actions/checkout@v3
              with:
                fetch-depth: 0

            - name: Prepare branch to merge
              run: |
                  git checkout master
                  git checkout v2.x.x
                  git branch apiml/v2/merge
                  git cherry-pick master

            - name: Create pull request
              uses: actions/github-script@v6
              with:
                github-token: ${{ secrets.ZOWE_ROBOT_TOKEN }}
                script: |
                    await github.rest.pulls.create({
                        owner: 'zowe',
                        repo: 'api-layer',
                        title: 'Automatic merge to v2 branch',
                        body: 'Automatically prepared PR for merging into the V2 branch',
                        head: 'master',
                        base: 'apiml/v2/merge'
                    });
            